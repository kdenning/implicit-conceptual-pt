---
title: "Implicit Conceptual PT Data Analysis (for SAP requirement)"
author: "Kathryn Denning"
date: "2/14/2020"
output: 
  html_document:
    code_folding: "hide"
    toc: true
    toc_float: true
---

# Introduction to study

This study looked at whether people consider the conceptual perspectives (e.g., likes) of others without conscious awareness, and if this depends on whether the target individual has the same visibility of the target stimuli as them. Participants were asked to respond about how much they liked the stimuli after being trained on the targets' likes and dislikes. Implicit conceptual perspective taking would be found if people are slower to respond on inconsistent trials in comparison to consistent trials.

**Variable names included in the analysis:**

* **consistent**: Whether the participant had the same conceptual perspective as the target or not. Helemert contrasts were applied to this categorical variable. 
  + consistent: perspectives about whether or not they liked the stimuli were the same
  + inconsistent: perspectives were different
  + unknown: the participant does not know the target's perspective
  + dislike: the participant dislikes the stimuli; included as a comparison so that participants were not only responding "like" the entire time
* **visibility**: Whether the target individual can see the food stimuli or not.
* **exp_resp.rt **: Reaction time on trials in seconds.


```{r setup, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Cleaning
## import data

#install.packages("rio")
#install.packages("here")
#install.packages("tidyverse")
#install.packages("magrittr")
#install.packages("janitor")
#install.packages("lme4")
#install.packages("psy")
#install.packages("irr")
#install.packages("emmeans")
#install.packages("sjPlot")
#install.packages("effects")
#install.packages("fs")
library(rio)
library(here)
library(tidyverse)
library(magrittr)
library(janitor)
library(lme4)
library(psy)
library(irr)
library(psych)
library(sjPlot)
library(emmeans)
library(effects)
library(here)
library(fs)

#Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r combining datasets and cleaning, include = FALSE}
# Getting file names for each individual participants datasets into one character vector
files <- dir_ls(here::here("Data"), glob = "*.csv")

# Reading one dataset in to figure out how I want to clean it
sap1 <- readr::read_csv(file = files[1],
                col_names = TRUE)

# Practice cleaning on one dataset
sap1_sub <- sap1 %>% select(participant, expBlock.thisN, expTrials.thisN, 
                            facing_exp, person_exp, food_exp, showL_R, 
                            consistent, exp_resp.keys, exp_resp.rt) %>% 
  na.omit() %>% 
  mutate(trial_num = as.numeric(row_number()),
         consistent = as.factor(consistent),
         visibility = as.factor(ifelse(facing_exp == showL_R, "same", ifelse(facing_exp != showL_R, "diff", NA))))

# Writing a function to clean all the datasets using practice from above
## Only selecting variables we want from the larger Psychopy dataset
## Creating variables for trial number and for whether the target has the same visibility as the participant
clean_sap <- function(file) {
                    sap <- read_csv(file)
                    sap %>% 
                    select(participant, expBlock.thisN, expTrials.thisN, 
                            facing_exp, person_exp, food_exp, showL_R, 
                            consistent, exp_resp.keys, exp_resp.rt) %>% 
                      na.omit() %>% 
                      mutate(trial_num = as.numeric(row_number()),
                             consistent = as.factor(consistent),
                             visibility = as.factor(ifelse(facing_exp == showL_R, "Visible", ifelse(facing_exp != showL_R, "Not Visible", NA))),
                             consistent  = recode(consistent, 
                            `c` = "Consistent",
                            `i` = "Inconsistent",
                            `u` = "Unknown",
                            `y` = "Dislike"))
}

# Drop "6_APCT" files because participant never made it to experimental portion and dataset is in different format due to that
files <- grep("/6_ACPT", files, value = TRUE, invert = TRUE)

# Apply function to list of datasets to cycle through and create one overall dataset
data <- map_df(files, clean_sap, .id = "column_names")

# Read in and merge demographic information into overall dataset
dem <- read.csv("ACPT_dem.csv", header = TRUE) 

data_comb <- left_join(data, dem, by = "participant")

# Apply contrast codes to categorical variables
## Helmert codes to consistency variable
contrasts(data_comb$consistent)
CIUvY <- c(1, -1, -1, 3) 
PIvU <- c(-1, -1, 2, 0)  
CvI <- c(-1, 1, 0, 0) 
ConCodes <- cbind(CIUvY, PIvU, CvI)
contrasts(data_comb$consistent) <- ConCodes
contrasts(data_comb$consistent) 

## Effects codes for visibility variable
data_comb %<>% mutate(visibility_effects = recode(visibility, `Visible` = "-.5",
                                   `Not Visible` = ".5"))


```

# Demographics
## Number of participants with demographic data

```{r participant number}
data_comb %>% 
  select(participant) %>% 
  unique() %>% 
  nrow()
```

## Gender

```{r gender}
data_comb %>% 
  select(participant, gender) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(gender) %>% 
  count()
```

## Race

```{r race}
data_comb %>% 
  select(participant, race) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(race) %>% 
  count()
```

## Age

```{r age}
data_comb %>% 
  select(participant, age) %>% 
  na.omit() %>% 
  summarize(mean = mean(age),
            sd = sd(age))
```

## Class level

```{r class level}
data_comb %>% 
  select(participant, class_level) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(class_level) %>% 
  count()
```

## Parent's education

```{r parents education}
data_comb %>% 
  select(participant, parents_edu) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(parents_edu) %>% 
  count()
```

## Native language

```{r native language}
data_comb %>% 
  select(participant, english_native) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(english_native) %>% 
  count()
```

## Born in the US

```{r birth country}
data_comb %>% 
  select(participant, us_birth_country) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(us_birth_country) %>% 
  count()
```

## Raised in the US

```{r country raised in}
data_comb %>% 
  select(participant, us_raised) %>% 
  na.omit() %>% 
  unique() %>% 
  group_by(us_raised) %>% 
  count()
```

# Descriptives

## Mean and SD for reaction time by consistency condition

```{r mean and sd consistency}
data_consistent <- data_comb %>% 
  select(participant, consistent, exp_resp.rt) %>% 
  na.omit() %>% 
  group_by(consistent) %>% 
  summarize(mean_c = mean(exp_resp.rt),
            sd_c = sd(exp_resp.rt),
            se_c = sd(exp_resp.rt)/sqrt(length(exp_resp.rt)))
data_consistent 
```

## Mean and SD for reaction time by visibility condition

```{r mean and sd visibility}
data_visible <- data_comb %>% 
  select(participant, visibility, exp_resp.rt) %>% 
  na.omit() %>% 
  group_by(visibility) %>% 
  summarize(mean_v = mean(exp_resp.rt),
            sd_v = sd(exp_resp.rt),
            se_v = sd(exp_resp.rt)/sqrt(length(exp_resp.rt)))
data_visible
```

## Overall descriptives per variable

```{r overall dem}
data_comb %>% 
  select(visibility, consistent, exp_resp.rt) %>% 
  describe()
```

# Anova Results

```{r anova results}
model <- lm(exp_resp.rt ~ visibility_effects*consistent, data = data_comb)
summary(model)
```

Results of the within-subjects 2x4 Anova demonstrate that there is a main effect of visibility, with participants taking longer to respond when the stimuli was not visible to them than when it was, *b* = -0.02, *t*(61620) -2.29, *p* < 0.03. There was also a significant main effect of perspective consistency for the contrast comparing the consistent and inconsistent conditions with the unknown condition, *b* = -0.02, *t*(61620) -4.42, *p* < 0.001. All other contrasts were not significant, *ps* > 0.09. The interaction between visiblity and all perspective condition contrasts were also not significant, *ps* > 0.11.

# Plots
## Main effect of visibility on reaction time

```{r visibility main}
ggplot(data_visible, aes(x = visibility, y = mean_v, fill = visibility)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  scale_fill_viridis_d() +
  theme(legend.position = "none") +
  labs(title = "Main effect of target visibility on reaction time",
       x = "Visibility of stimuli to target",
       y = "Reaction time (seconds)") +
  geom_errorbar(aes(ymin = mean_v, ymax = mean_v + se_v), width =.2,
                position = position_dodge(.9)) 
```

## Main effect of consistency on reaction time

```{r consistentcy main}
ggplot(data_consistent, aes(x = consistent, y = mean_c, fill = consistent)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  scale_fill_viridis_d() +
  theme(legend.position = "none") +
  labs(title = "Main effect of perspective consistentcy on reaction time",
       x = "Perspective consistency condition",
       y = "Reaction time (seconds)") +
  geom_errorbar(aes(ymin = mean_c, ymax = mean_c + se_c), width =.2,
                position = position_dodge(.9)) 

```